<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Instructor Dashboard - CourseHive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes honeycomb {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }
        
        .honeycomb-bg {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 0L93.3 25V75L50 100L6.7 75V25L50 0Z' fill='%23f59e0b' fill-opacity='0.05' /%3E%3C/svg%3E");
        }
        
        .honeycomb-loader {
            width: 100px;
            height: 100px;
            position: relative;
            animation: honeycomb 2s infinite ease-in-out;
        }
        
        .honeycomb-loader:before, .honeycomb-loader:after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 0L93.3 25V75L50 100L6.7 75V25L50 0Z' fill='%23f59e0b' fill-opacity='0.8' /%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .honeycomb-loader:after {
            animation: honeycomb 2s 0.5s infinite ease-in-out;
            opacity: 0.6;
        }
        
        .card-honey {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(245, 158, 11, 0.2);
            transition: all 0.3s ease;
        }
        
        .card-honey:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.2);
        }
        
        .active-menu {
            background: rgba(245, 158, 11, 0.2);
            border-left: 4px solid #f59e0b;
        }
        
        .print-hide {
            display: block;
        }
        
        @media print {
            .print-hide {
                display: none !important;
            }
            
            body {
                background: white !important;
            }
            
            .print-show {
                display: block !important;
            }
        }
    </style>
</head>
<body class="bg-yellow-50 honeycomb-bg min-h-screen">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center z-50 transition-opacity duration-500">
        <div class="honeycomb-loader mb-8"></div>
        <h2 class="text-2xl font-bold text-yellow-600 animate-pulse">Loading CourseHive...</h2>
    </div>

    <!-- Authentication Check -->
    <script>
        const adminAuth = localStorage.getItem('adminAuth');
        const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
        
        if (!adminAuth || !currentAdmin || adminAuth !== "true") {
            localStorage.removeItem("adminAuth");
            localStorage.removeItem("currentAdmin");
            window.location.href = "index.html";
        }
    </script>

    <!-- Navbar -->
    <nav class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-4 shadow-lg print-hide">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="logo.png" alt="CourseHive" class="h-12 w-12">
                <div>
                    <h1 class="text-2xl font-bold text-white">CourseHive</h1>
                    <p class="text-yellow-100 text-sm">Course Management System</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-white hidden md:inline">Welcome,Course Instructor</span>
                </button>
                <button onclick="logout()" class="flex items-center space-x-1 bg-white text-yellow-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="hidden md:inline">Logout</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="flex print-hide">
        <!-- Sidebar -->
        <aside class="bg-yellow-400 w-64 min-h-screen p-6 shadow-lg">
            <div class="flex items-center space-x-3 mb-8">
                <img src="logo.png" alt="CourseHive" class="h-10 w-10">
                <h2 class="text-xl font-bold text-white">Instructor Panel</h2>
            </div>
            <ul class="space-y-2">
                <li><a href="#" onclick="showDashboard()" id="dashboardMenu" class="block text-white text-lg font-semibold p-3 rounded-lg hover:bg-yellow-500 transition active-menu"><i class="fas fa-tachometer-alt mr-3"></i>Dashboard</a></li>
                <li><a href="#" onclick="showAdminManagement()" id="adminManagementMenu" class="block text-white text-lg font-semibold p-3 rounded-lg hover:bg-yellow-500 transition"><i class="fas fa-users-cog mr-3"></i>Instructor Management</a></li>
                <li><a href="#" onclick="showCourseManagement()" id="courseManagementMenu" class="block text-white text-lg font-semibold p-3 rounded-lg hover:bg-yellow-500 transition"><i class="fas fa-book mr-3"></i>Manage Courses</a></li>
                <li><a href="#" onclick="showEnrollmentManagement()" id="enrollmentManagementMenu" class="block text-white text-lg font-semibold p-3 rounded-lg hover:bg-yellow-500 transition"><i class="fas fa-user-graduate mr-3"></i>View Enrollments</a></li>
            </ul>
            <div class="mt-12 p-4 bg-yellow-500 bg-opacity-30 rounded-lg">
                <h3 class="text-white font-semibold mb-2">Quick Stats</h3>
                <p class="text-white text-sm" id="sidebarCourseCount">0 courses</p>
                <p class="text-white text-sm" id="sidebarEnrollmentCount">0 enrollments</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <!-- Dashboard View -->
            <div id="dashboardView">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-yellow-600">Welcome back, <span id="dashboardUserName">Instructor</span></h2>
                        <p class="text-yellow-700">Here's what's happening with your courses today</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="printPage()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition flex items-center">
                            <i class="fas fa-print mr-2"></i> Print
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card-honey p-6 rounded-lg shadow-lg border border-yellow-100">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full mr-4">
                                <i class="fas fa-users text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500">Instructors</p>
                                <h3 class="text-2xl font-bold text-yellow-600" id="adminCount">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="card-honey p-6 rounded-lg shadow-lg border border-yellow-100">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full mr-4">
                                <i class="fas fa-book text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500">Active Courses</p>
                                <h3 class="text-2xl font-bold text-yellow-600" id="courseCount">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="card-honey p-6 rounded-lg shadow-lg border border-yellow-100">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full mr-4">
                                <i class="fas fa-user-graduate text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500">Total Enrollments</p>
                                <h3 class="text-2xl font-bold text-yellow-600" id="enrollmentCount">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="card-honey p-6 rounded-lg shadow-lg border border-yellow-100">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full mr-4">
                                <i class="fas fa-person text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-500">Total Number of Student</p>
                                <h3 class="text-2xl font-bold text-yellow-600" id="studentCount">30</h3>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card-honey p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold text-yellow-600 mb-4">Recent Enrollments</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="border-b border-yellow-100">
                                        <th class="py-2 px-4 text-left text-gray-600">Student</th>
                                        <th class="py-2 px-4 text-left text-gray-600">Course</th>
                                        <th class="py-2 px-4 text-left text-gray-600">Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentEnrollmentsTable">
                                    <!-- Recent enrollments will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-honey p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold text-yellow-600 mb-4">Upcoming Courses</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="border-b border-yellow-100">
                                        <th class="py-2 px-4 text-left text-gray-600">Course</th>
                                        <th class="py-2 px-4 text-left text-gray-600">Starts</th>
                                        <th class="py-2 px-4 text-left text-gray-600">Seats</th>
                                    </tr>
                                </thead>
                                <tbody id="upcomingCoursesTable">
                                    <!-- Upcoming courses will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructor Management View -->
            <div id="adminManagementView" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-yellow-600">Instructor Management</h2>
                    <button onclick="printPage()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition flex items-center">
                        <i class="fas fa-print mr-2"></i> Print
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card-honey p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold text-yellow-600 mb-4">Change Password</h3>
                        <form id="changePasswordForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Current Password</label>
                                <div class="relative">
                                    <input type="password" id="currentPassword" placeholder="Enter current password" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-lock absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">New Password</label>
                                <div class="relative">
                                    <input type="password" id="newPassword" placeholder="Enter new password" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-key absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Confirm Password</label>
                                <div class="relative">
                                    <input type="password" id="confirmPassword" placeholder="Confirm new password" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-key absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                            </div>
                            <div id="passwordError" class="text-red-500 mb-4 text-sm hidden"></div>
                            <button type="submit" class="w-full bg-yellow-500 text-white py-3 rounded-lg hover:bg-yellow-600 transition font-semibold">
                                <i class="fas fa-save mr-2"></i> Change Password
                            </button>
                        </form>
                    </div>
                    
                    <div class="card-honey p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold text-yellow-600 mb-4">Add New Instructor</h3>
                        <form id="addAdminForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Full Name</label>
                                <div class="relative">
                                    <input type="text" id="newAdminName" placeholder="Enter full name" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-user absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Username</label>
                                <div class="relative">
                                    <input type="text" id="newAdminUsername" placeholder="Enter username" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-at absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="newAdminPassword" placeholder="Enter password" required 
                                           class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <i class="fas fa-lock absolute right-3 top-3 text-yellow-500"></i>
                                </div>
                                <p class="text-gray-500 text-xs mt-1">Minimum 6 characters</p>
                            </div>
                            <div id="adminAddError" class="text-red-500 mb-4 text-sm hidden"></div>
                            <button type="submit" class="w-full bg-yellow-500 text-white py-3 rounded-lg hover:bg-yellow-600 transition font-semibold">
                                <i class="fas fa-user-plus mr-2"></i> Add Instructor
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Course Management View -->
            <div id="courseManagementView" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-yellow-600">Course Management</h2>
                    <div class="flex space-x-3">
                        <button onclick="printPage()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition flex items-center">
                            <i class="fas fa-print mr-2"></i> Print
                        </button>
                        <button onclick="showAddCourseModal()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add New Course
                        </button>
                    </div>
                </div>
                
                <div class="card-honey p-6 rounded-lg shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-yellow-50">
                                <tr>
                                    <th class="py-3 px-4 text-left text-yellow-600">Course</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Teacher</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Duration</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Seats</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Fees</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coursesTableBody" class="divide-y divide-yellow-100">
                                <!-- Courses will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Enrollment Management View -->
            <div id="enrollmentManagementView" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-yellow-600">Course Enrollments</h2>
                    <button onclick="printPage()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition flex items-center">
                        <i class="fas fa-print mr-2"></i> Print
                    </button>
                </div>
                
                <div class="card-honey p-6 rounded-lg shadow-lg">
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Filter by Course:</label>
                        <div class="relative">
                            <select id="courseFilter" onchange="loadEnrollments()" class="w-full p-3 border border-yellow-200 rounded-lg appearance-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                <option value="">All Courses</option>
                                <!-- Courses will be loaded here -->
                            </select>
                            <i class="fas fa-chevron-down absolute right-3 top-3 text-yellow-500 pointer-events-none"></i>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-yellow-50">
                                <tr>
                                    <th class="py-3 px-4 text-left text-yellow-600">Student</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Email</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Course</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Enrollment Date</th>
                                    <th class="py-3 px-4 text-left text-yellow-600">Progress</th>
                                </tr>
                            </thead>
                            <tbody id="enrollmentsTableBody" class="divide-y divide-yellow-100">
                                <!-- Enrollments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Course Modal -->
    <div id="addCourseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-yellow-600" id="courseModalTitle">Add New Course</h3>
                <button onclick="hideAddCourseModal()" class="text-gray-500 hover:text-gray-700 text-xl">
                    ✕
                </button>
            </div>
            
            <form id="addCourseForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Course Name</label>
                        <input type="text" id="courseName" placeholder="Enter course name" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">Teacher</label>
                        <input type="text" id="courseTeacher" placeholder="Enter teacher name" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Start Date</label>
                        <input type="date" id="courseStartDate" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">End Date</label>
                        <input type="date" id="courseEndDate" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Available Seats</label>
                        <input type="number" id="courseSeats" placeholder="Enter available seats" min="1" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">Course Fees (₹)</label>
                        <input type="number" id="courseFees" placeholder="Enter course fees" min="0" step="0.01" required 
                               class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 mb-1">Course Image</label>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="file" id="courseImage" accept="image/*" class="hidden">
                            <label for="courseImage" class="cursor-pointer bg-yellow-100 text-yellow-600 px-4 py-2 rounded-lg hover:bg-yellow-200 transition">
                                <i class="fas fa-upload mr-2"></i> Choose Image
                            </label>
                            <span id="imageFileName" class="text-sm text-gray-500 ml-2">No image selected</span>
                        </div>
                        <div id="imagePreview" class="w-16 h-16 bg-gray-100 rounded-lg overflow-hidden hidden">
                            <img id="previewImage" src="#" alt="Preview" class="w-full h-full object-cover">
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 mb-1">Course Description</label>
                    <textarea id="courseDescription" placeholder="Enter course description" rows="4" required 
                              class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"></textarea>
                </div>
                
                <div id="courseError" class="text-red-500 text-sm hidden"></div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="hideAddCourseModal()" 
                            class="px-6 py-2 border border-yellow-500 text-yellow-500 rounded-lg hover:bg-yellow-50 transition">
                        Cancel
                    </button>
                    <button type="submit" id="courseSubmitBtn"
                            class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition font-semibold">
                        <i class="fas fa-save mr-2"></i> Save Course
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize IndexedDB
        const dbName = 'CourseHiveDB';
        const dbVersion = 1;
        let db;

        function openDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(dbName, dbVersion);
                
                request.onerror = (event) => {
                    console.error('Database error:', event.target.error);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('courseImages')) {
                        db.createObjectStore('courseImages', { keyPath: 'courseId' });
                    }
                };
            });
        }

        function saveImageToDB(courseId, imageData) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['courseImages'], 'readwrite');
                const store = transaction.objectStore('courseImages');
                const request = store.put({ courseId, imageData });
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    resolve();
                };
            });
        }

        function deleteImageFromDB(courseId) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['courseImages'], 'readwrite');
                const store = transaction.objectStore('courseImages');
                const request = store.delete(courseId);
                
                request.onerror = (event) => {
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    resolve();
                };
            });
        }

        // Simulate loading
        setTimeout(() => {
            document.getElementById('loadingScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 500);
        }, 1500);
        
        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('adminManagementView').classList.add('hidden');
            document.getElementById('courseManagementView').classList.add('hidden');
            document.getElementById('enrollmentManagementView').classList.add('hidden');
            
            // Update active menu
            document.querySelectorAll('#dashboardMenu, #adminManagementMenu, #courseManagementMenu, #enrollmentManagementMenu')
                .forEach(el => el.classList.remove('active-menu'));
            document.getElementById('dashboardMenu').classList.add('active-menu');
            
            updateCounts();
            loadRecentEnrollments();
            loadUpcomingCourses();
        }
        
        function showAdminManagement() {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('adminManagementView').classList.remove('hidden');
            document.getElementById('courseManagementView').classList.add('hidden');
            document.getElementById('enrollmentManagementView').classList.add('hidden');
            
            // Update active menu
            document.querySelectorAll('#dashboardMenu, #adminManagementMenu, #courseManagementMenu, #enrollmentManagementMenu')
                .forEach(el => el.classList.remove('active-menu'));
            document.getElementById('adminManagementMenu').classList.add('active-menu');
        }
        
        function showCourseManagement() {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('adminManagementView').classList.add('hidden');
            document.getElementById('courseManagementView').classList.remove('hidden');
            document.getElementById('enrollmentManagementView').classList.add('hidden');
            
            // Update active menu
            document.querySelectorAll('#dashboardMenu, #adminManagementMenu, #courseManagementMenu, #enrollmentManagementMenu')
                .forEach(el => el.classList.remove('active-menu'));
            document.getElementById('courseManagementMenu').classList.add('active-menu');
            
            loadCourses();
        }
        
        function showEnrollmentManagement() {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('adminManagementView').classList.add('hidden');
            document.getElementById('courseManagementView').classList.add('hidden');
            document.getElementById('enrollmentManagementView').classList.remove('hidden');
            
            // Update active menu
            document.querySelectorAll('#dashboardMenu, #adminManagementMenu, #courseManagementMenu, #enrollmentManagementMenu')
                .forEach(el => el.classList.remove('active-menu'));
            document.getElementById('enrollmentManagementMenu').classList.add('active-menu');
            
            loadCourseFilter();
            loadEnrollments();
        }
        
        function showAddCourseModal() {
            document.getElementById('addCourseModal').classList.remove('hidden');
            document.getElementById('courseModalTitle').textContent = 'Add New Course';
            document.getElementById('courseSubmitBtn').innerHTML = '<i class="fas fa-save mr-2"></i> Save Course';
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('courseStartDate').value = today;
            document.getElementById('courseEndDate').value = today;
            
            // Reset form
            document.getElementById('addCourseForm').reset();
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('imageFileName').textContent = 'No image selected';
            document.getElementById('courseError').classList.add('hidden');
            
            // Remove any stored edit ID
            document.getElementById('addCourseForm').removeAttribute('data-edit-id');
        }
        
        function hideAddCourseModal() {
            document.getElementById('addCourseModal').classList.add('hidden');
        }
        
        // Image preview handler
        document.getElementById('courseImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('imageFileName').textContent = file.name;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('previewImage').src = event.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });
        
        // Data functions
        function updateCounts() {
            try {
                const admins = JSON.parse(localStorage.getItem('admins') || '[]');
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                const enrollments = JSON.parse(localStorage.getItem('enrollments') || []);
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
                
                // Update dashboard counts
                document.getElementById('adminCount').textContent = admins.length;
                document.getElementById('courseCount').textContent = courses.length;
                document.getElementById('enrollmentCount').textContent = enrollments.length;
                document.getElementById('studentCount').textContent = enrollments.length;
                
                // Update sidebar counts
                document.getElementById('sidebarCourseCount').textContent = `${courses.length} active courses`;
                document.getElementById('sidebarEnrollmentCount').textContent = `${enrollments.length} total enrollments`;
                
                // Update welcome message
                if (currentAdmin && currentAdmin.name) {
                    document.getElementById('userName').textContent = currentAdmin.name;
                    document.getElementById('dashboardUserName').textContent = currentAdmin.name;
                }
            } catch (e) {
                console.error("Error updating counts:", e);
            }
        }
        
        function loadRecentEnrollments() {
            try {
                const enrollments = JSON.parse(localStorage.getItem('enrollments') || []);
                const courses = JSON.parse(localStorage.getItem('courses') || []);
                const tableBody = document.getElementById('recentEnrollmentsTable');
                tableBody.innerHTML = '';
                
                // Sort by most recent and take first 5
                const recentEnrollments = enrollments
                    .sort((a, b) => new Date(b.enrollmentDate) - new Date(a.enrollmentDate))
                    .slice(0, 5);
                
                if (recentEnrollments.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="py-4 text-center text-gray-500">No recent enrollments</td></tr>';
                    return;
                }
                
                recentEnrollments.forEach(enrollment => {
                    const course = courses.find(c => c.id === enrollment.courseId);
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-yellow-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">${enrollment.studentName}</td>
                        <td class="py-3 px-4">${course ? course.name : 'Course not found'}</td>
                        <td class="py-3 px-4">${formatDate(enrollment.enrollmentDate)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (e) {
                console.error("Error loading recent enrollments:", e);
            }
        }
        
        function loadUpcomingCourses() {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || []);
                const tableBody = document.getElementById('upcomingCoursesTable');
                tableBody.innerHTML = '';
                
                // Filter upcoming courses (starting in next 30 days) and sort by start date
                const today = new Date();
                const nextMonth = new Date();
                nextMonth.setDate(today.getDate() + 30);
                
                const upcomingCourses = courses
                    .filter(course => {
                        const startDate = new Date(course.startDate);
                        return startDate >= today && startDate <= nextMonth;
                    })
                    .sort((a, b) => new Date(a.startDate) - new Date(b.startDate))
                    .slice(0, 5);
                
                if (upcomingCourses.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="py-4 text-center text-gray-500">No upcoming courses</td></tr>';
                    return;
                }
                
                upcomingCourses.forEach(course => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-yellow-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">${course.name}</td>
                        <td class="py-3 px-4">${formatDate(course.startDate)}</td>
                        <td class="py-3 px-4">${course.seats}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (e) {
                console.error("Error loading upcoming courses:", e);
            }
        }
        
        function loadCourses() {
            try {
                const courses = JSON.parse(localStorage.getItem('courses') || []);
                const tableBody = document.getElementById('coursesTableBody');
                tableBody.innerHTML = '';
                
                if (courses.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="py-4 text-center text-gray-500">No courses found</td></tr>';
                    return;
                }
                
                courses.forEach(course => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-yellow-50';
                    row.innerHTML = `
                        <td class="py-3 px-4 font-medium">${course.name}</td>
                        <td class="py-3 px-4">${course.teacher}</td>
                        <td class="py-3 px-4">${formatDate(course.startDate)} - ${formatDate(course.endDate)}</td>
                        <td class="py-3 px-4">${course.seats}</td>
                        <td class="py-3 px-4">₹${parseFloat(course.fees).toFixed(2)}</td>
                        <td class="py-3 px-4">
                            <button onclick="editCourse('${course.id}')" class="text-yellow-600 hover:text-yellow-800 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteCourse('${course.id}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (e) {
                console.error("Error loading courses:", e);
            }
        }
        
        function loadCourseFilter() {
            const courses = JSON.parse(localStorage.getItem('courses') || []);
            const filter = document.getElementById('courseFilter');
            
            // Clear existing options except the first one
            while (filter.options.length > 1) {
                filter.remove(1);
            }
            
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = course.name;
                filter.appendChild(option);
            });
        }
        
        function loadEnrollments() {
            const enrollments = JSON.parse(localStorage.getItem('enrollments') || []);
            const courses = JSON.parse(localStorage.getItem('courses') || []);
            const selectedCourseId = document.getElementById('courseFilter').value;
            
            const filteredEnrollments = selectedCourseId 
                ? enrollments.filter(e => e.courseId === selectedCourseId)
                : enrollments;
            
            const tableBody = document.getElementById('enrollmentsTableBody');
            tableBody.innerHTML = '';
            
            if (filteredEnrollments.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="py-4 text-center text-gray-500">No enrollments found</td></tr>';
                return;
            }
            
            filteredEnrollments.forEach(enrollment => {
                const course = courses.find(c => c.id === enrollment.courseId);
                const row = document.createElement('tr');
                row.className = 'hover:bg-yellow-50';
                row.innerHTML = `
                    <td class="py-3 px-4">${enrollment.studentName}</td>
                    <td class="py-3 px-4">${enrollment.studentEmail}</td>
                    <td class="py-3 px-4">${course ? course.name : 'Course not found'}</td>
                    <td class="py-3 px-4">${formatDate(enrollment.enrollmentDate)}</td>
                    <td class="py-3 px-4">
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2.5 mr-2">
                                <div class="bg-yellow-500 h-2.5 rounded-full" style="width: ${enrollment.progress}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${enrollment.progress}%</span>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function formatDate(dateString) {
            try {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            } catch (e) {
                return dateString;
            }
        }
        
        // Form handlers
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorElement = document.getElementById('passwordError');
            
            try {
                const admins = JSON.parse(localStorage.getItem('admins'));
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
                
                if (currentPassword !== currentAdmin.password) {
                    throw new Error("Current password is incorrect");
                }
                if (newPassword.length < 6) {
                    throw new Error("Password must be at least 6 characters");
                }
                if (newPassword !== confirmPassword) {
                    throw new Error("Passwords don't match");
                }
                
                // Update password
                const adminIndex = admins.findIndex(a => a.username === currentAdmin.username);
                admins[adminIndex].password = newPassword;
                currentAdmin.password = newPassword;
                
                localStorage.setItem('admins', JSON.stringify(admins));
                localStorage.setItem('currentAdmin', JSON.stringify(currentAdmin));
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Password changed successfully!';
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.classList.add('animate-fade-out');
                    setTimeout(() => successMsg.remove(), 500);
                }, 3000);
                
                this.reset();
                errorElement.classList.add('hidden');
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.classList.remove('hidden');
            }
        });
        
        document.getElementById('addAdminForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('newAdminName').value.trim();
            const username = document.getElementById('newAdminUsername').value.trim();
            const password = document.getElementById('newAdminPassword').value;
            const errorElement = document.getElementById('adminAddError');
            
            try {
                if (!name || !username || !password) {
                    throw new Error("All fields are required");
                }
                if (password.length < 6) {
                    throw new Error("Password must be at least 6 characters");
                }
                
                const admins = JSON.parse(localStorage.getItem('admins'));
                if (admins.some(a => a.username === username)) {
                    throw new Error("Username already exists");
                }
                
                admins.push({ 
                    username, 
                    password, 
                    name, 
                    email: `${username}@coursehive.com`,
                    role: 'instructor'
                });
                localStorage.setItem('admins', JSON.stringify(admins));
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                successMsg.innerHTML = `<i class="fas fa-check-circle mr-2"></i> Instructor ${name} added successfully!`;
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.classList.add('animate-fade-out');
                    setTimeout(() => successMsg.remove(), 500);
                }, 3000);
                
                this.reset();
                errorElement.classList.add('hidden');
                updateCounts();
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.classList.remove('hidden');
            }
        });
        
        document.getElementById('addCourseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('courseName').value.trim();
            const teacher = document.getElementById('courseTeacher').value.trim();
            const startDate = document.getElementById('courseStartDate').value;
            const endDate = document.getElementById('courseEndDate').value;
            const seats = parseInt(document.getElementById('courseSeats').value);
            const fees = parseFloat(document.getElementById('courseFees').value);
            const description = document.getElementById('courseDescription').value.trim();
            const imageFile = document.getElementById('courseImage').files[0];
            const errorElement = document.getElementById('courseError');
            
            try {
                if (!name || !teacher || !startDate || !endDate || isNaN(seats) || isNaN(fees) || !description) {
                    throw new Error("All fields are required");
                }
                if (new Date(startDate) > new Date(endDate)) {
                    throw new Error("End date must be after start date");
                }
                if (seats < 1) {
                    throw new Error("Minimum 1 seat required");
                }
                if (fees < 0) {
                    throw new Error("Fees cannot be negative");
                }
                
                const courses = JSON.parse(localStorage.getItem('courses') || []);
                const editId = this.getAttribute('data-edit-id');
                
                // Handle image
                let imageId = null;
                if (imageFile) {
                    const reader = new FileReader();
                    imageId = editId || Date.now().toString();
                    
                    await new Promise((resolve, reject) => {
                        reader.onload = async function(event) {
                            try {
                                await saveImageToDB(imageId, event.target.result);
                                resolve();
                            } catch (error) {
                                reject(error);
                            }
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(imageFile);
                    });
                }
                
                if (editId) {
                    // Update existing course
                    const courseIndex = courses.findIndex(c => c.id === editId);
                    if (courseIndex !== -1) {
                        courses[courseIndex] = {
                            ...courses[courseIndex],
                            name,
                            teacher,
                            startDate,
                            endDate,
                            seats,
                            fees: fees.toFixed(2),
                            description,
                            imageId: imageId || courses[courseIndex].imageId
                        };
                    }
                    
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                    successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Course updated successfully!';
                    document.body.appendChild(successMsg);
                } else {
                    // Add new course
                    courses.push({
                        id: Date.now().toString(),
                        name,
                        teacher,
                        startDate,
                        endDate,
                        seats,
                        fees: fees.toFixed(2),
                        description,
                        imageId: imageId || null
                    });
                    
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                    successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Course added successfully!';
                    document.body.appendChild(successMsg);
                }
                
                setTimeout(() => {
                    if (successMsg) {
                        successMsg.classList.add('animate-fade-out');
                        setTimeout(() => successMsg.remove(), 500);
                    }
                }, 3000);
                
                localStorage.setItem('courses', JSON.stringify(courses));
                hideAddCourseModal();
                loadCourses();
                updateCounts();
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.classList.remove('hidden');
            }
        });
        
        async function editCourse(id) {
            const courses = JSON.parse(localStorage.getItem('courses'));
            const course = courses.find(c => c.id === id);
            
            if (!course) {
                alert("Course not found");
                return;
            }
            
            // Fill the form with course data
            document.getElementById('courseName').value = course.name;
            document.getElementById('courseTeacher').value = course.teacher;
            document.getElementById('courseStartDate').value = course.startDate;
            document.getElementById('courseEndDate').value = course.endDate;
            document.getElementById('courseSeats').value = course.seats;
            document.getElementById('courseFees').value = course.fees;
            document.getElementById('courseDescription').value = course.description;
            
            // Show image preview if exists
            if (course.imageId) {
                try {
                    const imageData = await getImageFromDB(course.imageId);
                    if (imageData) {
                        document.getElementById('previewImage').src = imageData;
                        document.getElementById('imagePreview').classList.remove('hidden');
                        document.getElementById('imageFileName').textContent = 'Current image';
                    }
                } catch (e) {
                    console.error("Error loading image:", e);
                }
            } else {
                document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('imageFileName').textContent = 'No image selected';
            }
            
            // Change the modal title and button
            document.getElementById('courseModalTitle').textContent = 'Edit Course';
            document.getElementById('courseSubmitBtn').innerHTML = '<i class="fas fa-save mr-2"></i> Update Course';
            
            // Set the edit ID on the form
            document.getElementById('addCourseForm').setAttribute('data-edit-id', id);
            
            // Show the modal
            document.getElementById('addCourseModal').classList.remove('hidden');
        }
        
        async function deleteCourse(id) {
            if (confirm("Are you sure you want to delete this course? This action cannot be undone.")) {
                try {
                    const courses = JSON.parse(localStorage.getItem('courses'));
                    const course = courses.find(c => c.id === id);
                    const updatedCourses = courses.filter(c => c.id !== id);
                    
                    // Delete image from IndexedDB if exists
                    if (course.imageId) {
                        await deleteImageFromDB(course.imageId);
                    }
                    
                    localStorage.setItem('courses', JSON.stringify(updatedCourses));
                    
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                    successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Course deleted successfully!';
                    document.body.appendChild(successMsg);
                    
                    setTimeout(() => {
                        successMsg.classList.add('animate-fade-out');
                        setTimeout(() => successMsg.remove(), 500);
                    }, 3000);
                    
                    loadCourses();
                    updateCounts();
                } catch (e) {
                    console.error("Error deleting course:", e);
                }
            }
        }
        
        function printPage() {
            window.print();
        }
        
        function logout() {
            localStorage.removeItem('adminAuth');
            localStorage.removeItem('currentAdmin');
            window.location.href = 'index.html';
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await openDatabase();
            updateCounts();
            showDashboard();
            
            // Set current admin name if available
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            if (currentAdmin && currentAdmin.name) {
                document.getElementById('userName').textContent = currentAdmin.name;
                document.getElementById('dashboardUserName').textContent = currentAdmin.name;
            }
        });
    </script>
</body>
</html>